(()=>{"use strict";var e={584:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.plot=t.stack=t.clear=t.plotContainer=t.plots=void 0;var r=n(159),o=Number(process.env.PORT)||8080,i=new r.Server(o);function s(e,n){a(e,n);var r=n?{data:e,layout:n}:{data:e};t.plots.push(r)}function a(e,t){if(!(e instanceof Array)||0===e.length)throw new TypeError("Plot data must be an array with at least 1 element");if(t&&!(t instanceof Object))throw new TypeError("Layout must be an object")}t.plots=[],t.plotContainer={},t.clear=function(){t.plots=[]},t.stack=s,t.plot=function(e,n){e&&(a(e,n),s(e,n));var r=Object.keys(t.plotContainer).length;t.plotContainer[r]={opened:!1,pending:!1,plots:t.plots},t.plots=[],i.spawn(t.plotContainer)}},159:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;var i=n(81),s=n(147),a=n(685),c=n(37),l=n(17),u=function(){function e(e){var t=this;this.plotsContainer={},this.sockets={},this.nextSocketID=0,this.port=e,this.instance=this.createServer(),this.instance.on("connection",(function(e){var n=t.nextSocketID++;t.sockets[n]=e,e.on("close",(function(){delete t.sockets[n]}))}))}return e.prototype.spawn=function(e){this.plotsContainer=e,this.instance.address()||this.instance.listen(this.port),this.openBrowserWindow()},e.prototype.clean=function(){this.instance.address()&&this.instance.close();for(var e=0,t=Object.values(this.sockets);e<t.length;e++)t[e].destroy();this.plotsContainer={}},e.prototype.openBrowserWindow=function(){for(var e=0,t=Object.entries(this.plotsContainer);e<t.length;e++){var n=t[e];n[1].opened||n[1].pending||(n[1].pending=!0,this.openWindow("http://localhost:"+this.port+"/plots/"+n[0]+"/index.html"))}},e.prototype.openWindow=function(e){switch((0,c.type)()){case"Linux":(0,i.exec)("xdg-open "+e);break;case"Darwin":(0,i.exec)("open "+e);break;case"Windows_NT":(0,i.exec)("start "+e)}},e.prototype.createServer=function(){var e=this;return(0,a.createServer)((function(t,n){return r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.serveData(t,n)];case 1:return e.sent()||this.serveWebsite(t,n),[2]}}))}))}))},e.prototype.serveData=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,s,a=this;return o(this,(function(o){switch(o.label){case 0:return e&&e.url&&e.url.match(/data\/[0-9]+/)?(n=e.url.split("/"),r=+n[n.length-1],i=this.plotsContainer[r],s=i&&i.plots,this.plotsContainer[r].opened=!0,this.plotsContainer[r].pending=!1,t.end(JSON.stringify(s)),[4,new Promise((function(e){return t.on("finish",(function(){a.close(),e()}))}))]):[3,2];case 1:return o.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.serveWebsite=function(e,t){var n=this;if(e&&e.url&&e.url.match(/plots\/[0-9]+\/index.html/)){var r=(o=e.url.split("/"))[o.length-2];(0,s.readFile)((0,l.join)(__dirname,"..","www","index.html"),"utf-8",(function(e,n){if(e)return t.writeHead(404),void t.end(JSON.stringify(e));n=n.replace("{{plotid}}",r),t.writeHead(200),t.end(n)}))}else{if(!(e&&e.url&&(e.url.match(/nodeplotlib.min.js/)||e.url&&e.url.match(/plotly.min.js/))))return t.writeHead(404),void t.end("Server address not found");var o,i=(o=e.url.split("/"))[o.length-1];(0,s.readFile)((0,l.join)(__dirname,"..","www",i),"utf-8",(function(e,r){if(e)return t.writeHead(404),void t.end(JSON.stringify(e));"nodeplotlib.min.js"===i&&(r=r.replace("{{port}}",""+n.port)),t.setHeader("content-type","text/javascript"),t.writeHead(200),t.end(r)}))}},e.prototype.close=function(){var e=Object.values(this.plotsContainer).reduce((function(e,t){return e||t.pending}),!1),t=Object.values(this.plotsContainer).reduce((function(e,t){return e&&t.opened}),!0);this.instance&&!e&&t&&this.clean()},e}();t.Server=u},81:e=>{e.exports=require("child_process")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.stack=e.clear=e.plot=void 0;var t=n(584);Object.defineProperty(e,"plot",{enumerable:!0,get:function(){return t.plot}}),Object.defineProperty(e,"clear",{enumerable:!0,get:function(){return t.clear}}),Object.defineProperty(e,"stack",{enumerable:!0,get:function(){return t.stack}})})();var o=exports;for(var i in r)o[i]=r[i];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();